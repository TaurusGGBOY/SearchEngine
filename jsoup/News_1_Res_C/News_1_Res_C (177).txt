第一章 架构 历史 系统 架构 三层 逻辑 架构 层 连接 授权 认证 层 核心 功能 在此 层 包括 查询 解析 分析 优化 缓存 内置 函数 跨 存储 引擎 功能 存储过程 触发器 视图 都在 一层 层 包括了 存储 引擎 负责 数据 存储 提取 连接 安全性 客户端 连接 服务器 进程 拥有 线程 连接 查询 只会 单独 线程 执行 线程 只能 轮流 核心 运行 服务器 负责 缓存 线程 新建 连接 创建 销毁 线程 优化 执行 解析 查询 创建 内部 数据结构 解析 树 优化 包括 重写 查询 表 读取 顺序 选择 合适 索引 用户 关键字 提示 优 化器 影响 决策 过程 优 化器 解释器 优化 过程 因素 使 用户 服务器 优化 决策 提供 参考 基准 二 并发 控制 两个 层面 并发 控制 服务器 层 存储 引擎 层 读写 锁 读写 锁 解决 多线程 脏数据 读 锁 共享 写 锁 排他 锁 粒度 给定 资源 锁定 数据 量 越小 系统 并发 程度 越高 加锁 也会 消耗 资源 锁 操作 锁 检查 锁 释放 锁 都会 增加 系统 开销 锁 策略 锁 开销 数据 安全性 寻求 平衡 商业 数据库系统 提供 更多 选择 都是在 表上 施 加行 锁 提供 多种 选择 每种 引擎 锁 策略 锁 粒度 两种 锁 策略 表 锁 行 级 锁 表 锁 表 锁 锁 策略 开销 最小 策略 锁定 整张 表 用户 表 操作 先 获取 写 锁 这会 阻塞 用户 改 表 读写操作 行 级 锁 行 级 锁 最大程度 支持 并发 带来 锁 开销 事务 事务 一组 原子 性 查询 独立 单元 执行 一组 语句 全 成功 全 失败 原子 性 一致性 隔 离性 持久性 运行 事务 系统 具备 标准 特征 原子 性 事 务必 须要 视为 不可分割 最小 单元 事务 操作 全 成功 失败 回滚 一致性 数据库 一致性 状态 转换 另一个 一致性 状态 隔 离性 事务 最终 提交 事务 时不 持久性 事务 提交 修改 数据 永久 保存 数据库 系统 崩溃 修改 数据 丢失 隔离级别 标准 定义 四种 隔离级别 每种 级别 事务 所做 修改 事务 事务 间 较低 级别 隔离 执行 更高 并发 系统 开销 更小 未 提交 读 事务 修改 未 提交 事务 事务 读取 未 提交 数据 称为 脏 读 提交 读 事务 提交 只能 提交 事务 所做 修改 级别 两次 执行 操作 称为 重复 读 重复 读 级别 保证 同一个 事务 读取 通用 记录 但当 事 务在 读取 范围内 记录 事务 又在 范围内 插入 数据 事务 再次 读取 幻 读 串行化 强制 事务 串行 读取 一行 数据 上都 加锁 导致 超时 和锁 争用 死锁 死锁 指 两个 多个 事务 资源 相互 占用 请求 锁定 对方 占有 资源 导致 恶性循环 事务日志 事务日志 存储 引擎 修改 表 数据 时只 修改 内存 拷贝 再把 修改 持久化 硬 盘上 存储 引擎 都是 称为 预 写 式 日志 修改 日志 需 要写 两次 磁盘 中的 事务 提供 两种 事务型 存储 引擎 自动 提交 默认 采用 自动 提交 模式 显 式 事务 查询 都被 当作 事务 提交 设置 变量 启用 禁用 自动 提交 模式 事务 混合 存储 引擎 如果在 事务 混合 事务 和非 事务型 表 事务回滚 非 事务型 表 撤销 提醒 报错 导致 数据 隐式 和显式 锁定 采用 阶段 锁定 协议 事务 执行 过程 随时 锁定 锁 执行 才会 释放 事务 隔离级别 加锁 支持 显 式 锁定 支持 语句 这是 服务器 层 存储 引擎 无关 应用到 事务 选择 事务型 存储 引擎 四 版本 并发 控制 事务型 存储 引擎 简单 行 级 锁 基于 并发性 版本 并发 控制 数据库 机制 行 级 锁 变种 很多 避免了 加锁 操作 开销 更低 非 阻塞 读 操作 写 操作 也只 锁定 行 保存 数据 快照 执行 多长时间 事务 数据 都是 事务 事务 张表 时刻 数据 每行 记录 保存 两个 隐藏 列 两个 列 保存 行 创建 版本号 保存 行 过期 删除 版本号 事务 版本号 自动 递增 事务 时刻 系统 版本号 事务 版本号 用来 查询 每行 记录 版本 号 具体操作 两个 条件 检查 每行 记录 只 查找 行 版本号 小于 等于 事务 版本 数据 行 确保 事务 读取 行 事务 事务 插入 修改 行 删除 版本 未定义 大于 事务 版本号 确保 事务 读取 行 事务 未被 删除 插入 一行 保存 系统 版本 号为 行 版本号 删除 一行 保存 系统 版本 号为 行 版本号 插入 一行 新纪录 保存 系统 版本 号 行 版本号 保存 系统 版本号 行 行 删除 标识 作用 级别 只在 两个 隔离级别 两个 隔离级别 不兼容 读取 最新 数据 行 符合 事务 版本 数据 行 读取 操作 加锁 五 存储 引擎 默认 引擎 设计 用来 短期 事务 短期 事务 都是 提交 很少 回滚 性能 自动 崩溃 修复 功能 非 事务 存储 需求 也很 流行 默认 存储 引擎 不支持 行 级 锁 事务 崩溃 修复 应用在 表 创建 导入 数据 修改 场景 
